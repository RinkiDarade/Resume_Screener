<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard | Smart Resume Screening</title>
    <link rel="stylesheet" href="/static/styles.css">
</head>
<body>
    <!-- Mobile Menu Button -->
    <button class="mobile-menu-btn" id="mobileMenuBtn">â˜°</button>

    <div class="dashboard">
        <!-- Side Panel -->
        <div class="side-panel" id="sidePanel">
            <div class="panel-header">
                <h2 class="panel-title">Smart Resume</h2>
                <p class="panel-subtitle">Recruitment Platform</p>
            </div>

            <div class="user-profile">
                <div class="user-avatar" id="userAvatar">{{ user_name[:2].upper() if user_name else 'U' }}</div>
                <div class="user-name" id="userName">{{ user_name or 'User' }}</div>
                <div class="user-email" id="userEmail">{{ user_email or '' }}</div>
            </div>

            <nav class="nav-menu">
                <a href="#" class="nav-item active" data-section="overview">
                    <span class="icon"></span>Dashboard
                </a>
                <a href="#" class="nav-item" data-section="process">
                    <span class="icon"></span>Screen Resumes
                </a>
                <a href="#" class="nav-item" data-section="candidates">
                    <span class="icon"></span>Candidates
                </a>
                <a href="#" class="nav-item" data-section="reports">
                    <span class="icon"></span>Reports
                </a>
                <a href="#" class="nav-item" data-section="settings">
                    <span class="icon"></span>Update Profile
                </a>
            </nav>

            <div class="logout-section">
                <a href="/logout" class="logout-btn">Logout</a>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Overview Section -->
            <div id="overview" class="dashboard-section active">
                <div class="content-header">
                    <h1 class="content-title">Dashboard Overview</h1>
                    <p class="content-subtitle">Your recruitment analytics and recent activity</p>
                </div>

                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-number" id="totalScreenings">0</div>
                        <div class="stat-label">Total Screenings</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="totalCandidates">0</div>
                        <div class="stat-label">Candidates Processed</div>
                    </div>
                    <!-- <div class="stat-card">
                        <div class="stat-number" id="avgScore">0%</div>
                        <div class="stat-label">Average Score</div>
                    </div> -->
                </div>

                <div class="candidate-list">
                    <div class="list-header">Recent Candidates</div>
                    <div id="recentCandidates">
                        <div class="candidate-item">
                            <span class="candidate-name">No candidates processed yet</span>
                            <span class="candidate-score score-fair">Start screening resumes</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Process Resumes Section -->
            <div class="process-form">
                <form id="processForm" action="/process" method="post" enctype="multipart/form-data">
                    <div class="form-group">
                        <label for="job_description">
                            Job Description
                            <span class="label-description">Enter the complete job description including requirements, responsibilities, and qualifications</span>
                        </label>
                        <textarea 
                            id="job_description" 
                            name="job_description" 
                            rows="8" 
                            placeholder="Enter detailed job description here..."
                            required
                        >{{ job_description or '' }}</textarea>
                    </div>

                    <div class="form-group">
                        <label for="mandatory_keywords">
                            Mandatory Keywords
                            <span class="label-description">Comma-separated list of essential skills and technologies</span>
                        </label>
                        <div style="display: flex; gap: 10px; align-items: flex-end;">
                            <input 
                                type="text" 
                                id="mandatory_keywords" 
                                name="mandatory_keywords" 
                                placeholder="e.g., Python, Machine Learning, SQL, React, AWS"
                                value="{{ mandatory_keywords or '' }}"
                                style="flex: 1;"
                                required
                            >
                            <button 
                                type="button" 
                                id="propagateBtn" 
                                class="btn btn-secondary"
                                onclick="propagateSkillsFromJD()"
                                style="white-space: nowrap;"
                            >
                                Propagate Skills from JD
                            </button>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>
                            <input type="radio" name="flow_type" value="new_flow" >
                                Upload New Resumes
                        </label>
                        </div>
                        <div>
                        <label>
                            <input type="radio" name="flow_type" value="old_flow">
                            
                            Upload from Existing Resume
                        </label>
                    </div>

                    <div class="form-group", id="upload_resume">
                        <label for="uploaded_resumes">
                            Resume Files
                            <span class="label-description">Upload multiple resume files (PDF, DOC, DOCX supported)</span>
                        </label>
                        <input 
                            type="file" 
                            id="uploaded_resumes" 
                            name="uploaded_resumes" 
                            multiple 
                            accept=".pdf,.doc,.docx"
                        
                        >
                    </div>

                    <div class="text-center">
                        <button type="submit" class="btn btn-primary">Process Resumes</button>
                    </div>
                </form>
            </div>

            <script>
            async function propagateSkillsFromJD() {
                const jobDescription = document.getElementById('job_description').value.trim();
                const propagateBtn = document.getElementById('propagateBtn');
                const keywordsField = document.getElementById('mandatory_keywords');
                
                if (!jobDescription) {
                    alert('Please enter a job description first!');
                    return;
                }
                
                // Show loading state
                propagateBtn.textContent = 'Extracting...';
                propagateBtn.disabled = true;
                
                try {
                    const response = await fetch('/extract-skills', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            job_description: jobDescription
                        })
                    });
                    
                    const data = await response.json();
                    
                    if (data.success) {
                        keywordsField.value = data.skills;
                        // Visual feedback
                        keywordsField.style.backgroundColor = '#e8f5e8';
                        setTimeout(() => {
                            keywordsField.style.backgroundColor = '';
                        }, 1000);
                    } else {
                        alert('Error extracting skills: ' + (data.error || 'Unknown error'));
                    }
                } catch (error) {
                    console.error('Error:', error);
                    alert('Network error occurred. Please try again.');
                } finally {
                    // Reset button
                    propagateBtn.textContent = 'Propagate Skills from JD';
                    propagateBtn.disabled = false;
                }
            }
            </script>

            <!-- Candidates Section -->
            <div id="candidates" class="dashboard-section">
                <div class="content-header">
                    <h1 class="content-title">All Candidates</h1>
                    <p class="content-subtitle">View and manage all processed candidates</p>
                </div>

                <div class="candidate-list">
                    <div class="list-header">Candidate Database</div>
                    <div id="allCandidates">
                        <div class="candidate-item">
                            <span class="candidate-name">No candidates available</span>
                            <span class="candidate-score score-fair">Process some resumes first</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Reports Section -->
            <div id="reports" class="dashboard-section">
                <div class="content-header">
                    <h1 class="content-title">Analytics & Reports</h1>
                    <p class="content-subtitle">Detailed insights and performance metrics</p>
                </div>

                <div class="stats-grid three-cols">
                    <div class="stat-card">
                        <div class="stat-number" id="excellentCandidates">0</div>
                        <div class="stat-label">Excellent Matches</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="goodCandidates">0</div>
                        <div class="stat-label">Good Matches</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="fairCandidates">0</div>
                        <div class="stat-label">Fair Matches</div>
                    </div>
                </div>

                <div class="candidate-list">
                    <div class="list-header">Screening History</div>
                    <div id="screeningHistory">
                        <div class="candidate-item">
                            <span class="candidate-name">No screening history available</span>
                            <span class="candidate-score score-fair">Start processing resumes</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Settings Section -->
            <div id="settings" class="dashboard-section">
                <div class="content-header">
                    <h1 class="content-title">Account Settings</h1>
                    <p class="content-subtitle">Manage your profile and preferences</p>
                </div>

                <div class="process-form">
                    <form id="settingsForm" action="/update-profile" method="post">
                        <div class="form-group">
                            <label for="settingsName">Full Name</label>
                            <input type="text" id="settingsName" name="name" placeholder="Your full name">
                        </div>

                        <div class="form-group">
                            <label for="settingsEmail">Email Address</label>
                            <input type="email" id="settingsEmail" name="email" placeholder="your@email.com">
                        </div>

                        <div class="form-group">
                            <label for="company">Company</label>
                            <input type="text" id="company" name="company" placeholder="Your company name">
                        </div>

                        <div class="text-center">
                            <button type="submit" class="btn btn-primary">Update Profile</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script>

                // Settings form
        document.getElementById('settingsForm').addEventListener('submit', function(e) {
            // Remove e.preventDefault() to allow form submission to backend
            const submitButton = e.target.querySelector('button[type="submit"]');
            if (submitButton) {
                submitButton.textContent = 'Updating...';
                submitButton.disabled = true;
            }
});
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize dashboard functionality
            initializeDashboard();
        });

        function initializeDashboard() {
            // Navigation functionality
            document.querySelectorAll('.nav-item').forEach(item => {
                item.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    // Remove active from all nav items and sections
                    document.querySelectorAll('.nav-item').forEach(nav => nav.classList.remove('active'));
                    document.querySelectorAll('.dashboard-section').forEach(section => section.classList.remove('active'));
                    
                    // Add active to clicked nav item
                    this.classList.add('active');
                    
                    // Show corresponding section
                    const sectionId = this.getAttribute('data-section');
                    const section = document.getElementById(sectionId);
                    if (section) {
                        section.classList.add('active');
                    }
                });
            });

            // Mobile menu toggle
            document.getElementById('mobileMenuBtn').addEventListener('click', function() {
                document.getElementById('sidePanel').classList.toggle('mobile-open');
            });

            // Close mobile menu when clicking outside
            document.addEventListener('click', function(e) {
                const sidePanel = document.getElementById('sidePanel');
                const mobileBtn = document.getElementById('mobileMenuBtn');
                
                if (window.innerWidth <= 768 && 
                    !sidePanel.contains(e.target) && 
                    !mobileBtn.contains(e.target)) {
                    sidePanel.classList.remove('mobile-open');
                }
            });

            // Process form submission
            document.getElementById('processForm').addEventListener('submit', function(e) {
                // Let the form submit to backend normally
                const submitButton = e.target.querySelector('button[type="submit"]');
                if (submitButton) {
                    submitButton.textContent = 'Processing...';
                    submitButton.disabled = true;
                }
            });

            // Settings form submission
            document.getElementById('settingsForm').addEventListener('submit', function(e) {
                e.preventDefault();
                alert('Profile updated successfully!');
            });
        }
    </script>

    <style>
        .dashboard-section {
            display: none;
        }
        .dashboard-section.active {
            display: block;
        }
        .logout-btn {
            display: block;
            width: 100%;
            text-align: center;
            text-decoration: none;
            background: rgba(156, 12, 79, 0.2);
            border: 1px solid rgba(239, 68, 68, 0.3);
            color: white;
            padding: 0.75rem;
            border-radius: 6px;
            transition: all 0.2s;
            font-weight: 600;
        }
        .logout-btn:hover {
            background: rgba(2, 30, 71, 0.3);
        }
        .logout-section {
            padding: 1.5rem;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            margin-top: auto;
        }
    </style>
</body>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
        <script>
    $(document).ready(function(){
    $('input[type="radio"][name="flow_type"]').change(function(){
        if ($(this).val() === 'new_flow') {
        $('#upload_resume').show(); // Show the div
        $('#processForm').attr('action', '/process_resume');
        } else {
        $('#upload_resume').hide(); // Hide the div
        $('#processForm').attr('action', '/process');
        }

    });
    });
    </script>
    
</html>





    